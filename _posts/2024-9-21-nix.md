---
layout: post
title: Use Nix to Setup Development Environment on MacOS
tags: rails ruby
---


### Why

use `nix develop` to spawn a shell with an application's development dependenciesin scope. To achieve this, you should create a flake that uses `mkShell`.


TBD

### What

Nix is a package manager and a build system. Its most important aspect is allowing to write declarative scripts for reproducible software builds.

- `installable` format: github:nixos/nixpkgs/nixpkgs-unstable#hello
  - url
  - attribute path.

comands:

- nix shell 
- nix build
- nix develop
- nix profile
- nix flake:

### How

- To check `nix store` disk usage: `du -hsc /nix/store`.
- To reduce nix store disk uage: `nix-collect-garbage`.
- For the design of nix, same servide will be launched for differernt project. To avoid conflicts, we can assign differernt ports for them. And kill those service on leave `nix shell`.


A samll discovery of rails. Rails will use `PGPORT` env variable, if it's defined, and use that port to connect to psql.

- Here is how to quit on exit shell: https://github.com/legendofmiracles/lila/blob/nix/shell.nix

but above only works on bash. for zsh, I have no clue.


### Where


### When


### Nix Language

**Syntax**

1. attrset

2. function
  - only take one argument each.

  input : body
  _ : {}


## Flake

a flake's outputs attrbiue is a function that takes the flake's inputs as an argument.

The first time an input is used in a flake command, Nix will pin it. Pinning an input means that Nix will fiture out the exact revision that it fetched, making sure everybody using this flake gets the exact the same one.

let bindings:

let
  system = builtins.currentSystem;
  pkgs = import nixpkgs { inherit sytem; };
in
{
  dev

- lookup paths: enclosing a path in angle brackets, e.g. <nixkpgs> causes the directories listent in the env variable `NIX_PATH` to be searched for the given file or directory name.

- Attrbute sets: key-value association.

- `android-sdks.inputs.nixpkgs.follows = "nixpkgs": this means the input (android-sdks) will have the same `nixpkgs` as input as current nixpkgs. 




**References**:

- [Nix Language Basics](https://nix.dev/tutorials/nix-language)
- ['nix shell' vs 'nix develop'](https://www.reddit.com/r/NixOS/comments/r15hx4/nix_shell_vs_nix_develop/)
